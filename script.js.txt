// Unit Conversion Data (Standardized to a Base Unit)
const data = {
    length: {
        base: 'meters',
        factors: { meters: 1, kilometers: 1000, feet: 0.3048, inches: 0.0254, miles: 1609.34 }
    },
    mass: {
        base: 'kilograms',
        factors: { kilograms: 1, grams: 0.001, pounds: 0.453592, ounces: 0.0283495 }
    },
    temp: { type: 'special' } // Temps require formulas, not factors
};

const category = document.getElementById('unitCategory');
const fromUnit = document.getElementById('fromUnit');
const toUnit = document.getElementById('toUnit');
const fromInput = document.getElementById('fromInput');
const toInput = document.getElementById('toInput');

// Populate Dropdowns
function populateUnits() {
    const cat = category.value;
    let options = '';
    
    if (cat === 'temp') {
        options = '<option value="c">Celsius</option><option value="f">Fahrenheit</option><option value="k">Kelvin</option>';
    } else {
        options = Object.keys(data[cat].factors).map(u => `<option value="${u}">${u}</option>`).join('');
    }
    
    fromUnit.innerHTML = options;
    toUnit.innerHTML = options;
    calculate();
}

// Validation & Calculation
function calculate() {
    const val = parseFloat(fromInput.value);
    if (isNaN(val)) {
        toInput.value = "";
        return;
    }

    const cat = category.value;
    const from = fromUnit.value;
    const to = toUnit.value;

    if (cat === 'temp') {
        toInput.value = convertTemp(val, from, to).toFixed(2);
    } else {
        const inBase = val * data[cat].factors[from];
        const result = inBase / data[cat].factors[to];
        toInput.value = result.toLocaleString(undefined, { maximumFractionDigits: 5 });
    }
}

function convertTemp(v, f, t) {
    let c;
    if (f === 'c') c = v;
    else if (f === 'f') c = (v - 32) * 5/9;
    else c = v - 273.15;

    if (t === 'c') return c;
    if (t === 'f') return (c * 9/5) + 32;
    return c + 273.15;
}

// Saving Functionality
document.getElementById('saveBtn').addEventListener('click', () => {
    if (!toInput.value) return;
    const log = document.createElement('li');
    log.innerHTML = `<strong>${fromInput.value} ${fromUnit.value}</strong> â†’ ${toInput.value} ${toUnit.value}`;
    document.getElementById('savedList').prepend(log);
});

// Event Listeners
category.addEventListener('change', populateUnits);
[fromInput, fromUnit, toUnit].forEach(el => el.addEventListener('input', calculate));

// Init
populateUnits();